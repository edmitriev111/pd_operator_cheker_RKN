Отлично, принято решение использовать Django. Вот обновленная полная версия Технического Задания (v2.2) с учетом этого выбора и всех предыдущих уточнений, в формате Markdown.

---

# Техническое задание на создание сайта "Цифровой юрист" (Версия 2.2 - Премиум, Django Backend)

**Дата:** 19.05.2024

## 1. Общие положения

*   **Название проекта:** Сайт "Цифровой юрист"
*   **Цель:** Создать современный, профессиональный веб-сайт для частнопрактикующего юриста, специализирующегося на юридической поддержке бизнеса в сферах защиты персональных данных (152-ФЗ и сопутствующие нормы) и сопровождения разработки/внедрения ПО. Сайт должен включать информационный контент об услугах, блог (с управлением через админ-панель), контакты и интерактивный инструмент для проверки компаний в реестре операторов ПДн Роскомнадзора (РКН).
*   **Позиционирование:** Сайт представляет услуги частнопрактикующего юриста (соло-специалиста).
*   **Целевая аудитория:** Руководители и представители IT-компаний, разработчики ПО, компании, обрабатывающие персональные данные клиентов/сотрудников, маркетологи, юристы инхаус.
*   **Тон коммуникации:** Экспертный, надежный, современный, технологичный, ориентированный на бизнес-результат, ведется **от первого лица** ("Я помогу...", "Мой опыт...", "Свяжитесь со мной"). Дизайн должен вызывать доверие и ощущение высокого качества услуг.
*   **Дата начала работ:** Апрель 2025 (ориентировочно).

---

## 2. Дизайн-концепция: "Современный технологичный профессионализм"

### 2.1. Общие принципы

*   **Стиль:** Чистый, минималистичный, но не примитивный. Акцент на качественной типографике, большом количестве "воздуха", плавной анимации и профессиональной иконографике. Отказ от метафор "папок" и "стикеров". Интуитивная структура, стандартная навигация.
*   **Референсы (для настроения и качества):**
    *   Stripe (https://stripe.com)
    *   Miro (https://miro.com/)
    *   Современные сайты консалтинговых/технологических компаний.
    *   *(Рекомендация: Добавить 1-2 референса по структуре/компоновке блоков)*
*   **Ключевые элементы:** Элегантные карточки, четкие CTA, профессиональные иконки, возможно, абстрактные фоновые элементы (тонкие линии, градиентные сетки, качественные тематические фото/иллюстрации с низкой насыщенностью).

### 2.2. Цветовая палитра и Темы

*   **Требование:** Реализовать **две** цветовые схемы: **темную** (основная) и **светлую** (альтернативная).
*   **Переключатель тем:** Предусмотреть иконку/переключатель в хедере. Выбор пользователя сохранять в `localStorage`.
*   **Темная тема (Пример):**
    *   Фон: `#1A202C` -> `#0D1117` (градиент).
    *   Блоки/Карточки: `#FFFFFF` (`opacity: 0.9`) или `#EAEAEA`, мягкие тени.
    *   Акцент: Один основной (примеры: `#3A7DFF`, `#00A8B5`, `#10B981`, `#6D28D9`).
    *   Второстепенные: `#6B7280`, `#D1D5DB`.
    *   Текст: `#E5E7EB`, `#F3F4F6`.
*   **Светлая тема (Пример):**
    *   Фон: `#F8F9FA` или `#FFFFFF`.
    *   Блоки/Карточки: `#FFFFFF`, мягкие тени (`box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05)`).
    *   Акцент: Тот же.
    *   Второстепенные: `#6B7280`, `#D1D5DB`.
    *   Текст: `#1F2937`.
*   **Контрастность:** Обеспечить достаточную читаемость в обеих темах.

### 2.3. Типографика

*   **Шрифт:** Inter (Google Fonts).
*   **Веса:** Light, Regular, Medium, SemiBold/Bold.
*   **Размеры (`rem`):** H1 (`~2.5`), H2 (`~2.0`), H3 (`~1.5`), P (`~1.0`, `line-height: 1.6-1.7`), Small (`~0.875`).
*   **Расстояния:** Внимание `line-height` и `letter-spacing`.

### 2.4. Элементы интерфейса (UI)

*   **Кнопки:** Основная CTA (заливка акцентом, `border-radius: 6px-8px`, `hover`), Второстепенная (контур/текст).
*   **Формы:** Поля ввода (фон/рамка зависят от темы, `border-radius: 4px-6px`, `:focus`), Placeholder'ы.
*   **Карточки:** Скругленные углы (`8px-16px`), тень, `padding`.
*   **Иконографика:** Качественный, консистентный набор (Feather, Phosphor, Heroicons или кастом).
*   **Навигация:**
    *   Десктоп: Хедер (лого слева, меню справа), возможно прозрачный/с фоном при скролле. В хедере переключатель тем.
    *   Мобильные/Планшеты: Хедер (лого, гамбургер справа), боковое/полноэкранное меню.

### 2.5. Анимации и микро-взаимодействия

*   **Принцип:** Плавные, быстрые, не навязчивые (`transition: all 0.3s ease-out`).
*   **Примеры:** `hover` эффекты, плавное появление контента при скролле (`opacity`, `transform`), модальные окна (масштаб/затухание), стильный лоадер для проверки ИНН.

---

## 3. Куки-баннер

*   **Описание:** Ненавязчивый баннер при первом входе (необходимые + аналитика Яндекс.Метрики).
*   **Компоновка (Десктоп):** Полоса внизу экрана (100% ширины, `max-width`, центрирование), контрастный фон, тень. Текст (заголовок, описание), элементы управления (чекбокс/тоггл "Аналитические куки", вкл. по умолч.), кнопки ("Принять все", "Настроить", "Отклонить необязательные").
*   **Компоновка (Мобильные):** Полоса внизу или модальное окно.
*   **Логика:** Показ при первом визите, сохранение выбора в `localStorage` (`cookieConsent`), условная загрузка Яндекс.Метрики.

---

## 4. Страницы сайта

### 4.1. Главная страница (`/`)

*   **Задача:** Представить юриста, ключевые услуги, ценность, быстрый доступ к РКН-проверке, CTA.
*   **Структура/Компоновка:**
    1.  **Хедер:** Лого, Навигация (Услуги, Инструменты, Блог, Контакты), Переключатель тем, Кнопка "Связаться".
    2.  **Первый экран (Hero):** H1 ("Цифровые решения для юридической защиты вашего бизнеса"), Описание (польза услуг, 2-3 строки), CTA ("Получить консультацию"). Фоновое изображение/графика.
    3.  **Секция "Проверьте риски":** H3 ("Узнайте, есть ли ваша компания в реестре РКН"), Форма (Поле ИНН, Кнопка "Проверить").
        *   **Зона вывода результата:**
            *   *Если найден:* 'Наименование организации', 'Номер уведомления', 'Дата уведомления', ссылка на карточку РКН, Статус ("В реестре"). Ссылка "Подробнее" -> `/tools`.
            *   *Если не найден:* Сообщение об отсутствии.
            *   *Ошибка/Лимит:* Сообщение об ошибке.
    4.  **Секция "Мои услуги":** H2 ("Как я могу помочь вашему бизнесу"), Карточки услуг (2-3 в ряд):
        *   "Защита персональных данных": Иконка, H4, Описание, Кнопка/Ссылка "Подробнее" (открывает модальное окно).
        *   "Сопровождение ПО": Аналогично.
        *   *Модальное окно услуги:* Заголовок, список под-услуг (иконки, описание), CTA ("Заказать услугу" / "Связаться").
    5.  **Секция "Ценность для вас" / "Почему это важно?":** H2 ("Снизьте риски и используйте возможности"), Блоки/Карточки (3 в ряд): "152-ФЗ: Штрафы...", "РКН: Уведомления...", "ПО: Льготы...". Ссылки на блог/услуги.
    6.  **Секция "Статистика":** Факты с **динамическим подсчетом**: "Проверено компаний через инструмент: [число]", "Найдено в реестре: [число]". Плавная анимация чисел.
    7.  **Секция CTA:** H3 ("Готовы обеспечить юридическую безопасность?"), Кнопка ("Связаться со мной" / "Оставить заявку").
    8.  **Футер:** Копирайт, Политика конфиденциальности, Навигация, Контакты.

*   **Адаптивность:** Корректная перестройка в 1-2 колонки на планшетах/мобильных.

### 4.2. Страница "Инструменты" (`/tools`)

*   **Задача:** Полнофункциональный инструмент проверки РКН с деталями и скачиванием PDF.
*   **Структура/Компоновка:**
    1.  Хедер.
    2.  H1: "Проверка компании в реестре Роскомнадзора".
    3.  Форма проверки: Поле ИНН, Кнопка "Проверить". Подсказка про время/лимит.
    4.  Область результатов:
        *   *Если найден:* Карта/Блок (Статус, Наименование, ИНН, Ответственное лицо, Контакты, Даты). Кнопка "Скачать результат в PDF". Ссылка "Что делать дальше?".
        *   *Если не найден:* Сообщение.
        *   *Ошибка/Лимит:* Сообщение.
    5.  Секция "Другие инструменты" (Анонсы): "Калькулятор рисков 152-ФЗ (Скоро)", "Проверка ПО в реестре Минцифры (В разработке)".
    6.  Футер.

*   **Адаптивность:** Форма и результаты адаптируются. 1 колонка на мобильных.

### 4.3. Страница "Блог" / "Полезное" (`/blog`)

*   **Задача:** Публикация экспертных статей, новостей, инструкций. Повышение экспертности и SEO. Управление через админ-панель Django.
*   **Структура/Компоновка:**
    1.  Хедер.
    2.  H1: "Блог" / "Полезные материалы".
    3.  Фильтр по категориям (Опционально): Кнопки/Теги ("Все", "Защита ПД", "ПО и IP", "Новости РКН", "Кейсы").
    4.  Сетка статей: Карточки (2-3 в ряд / 1 на моб.). Каждая: Изображение (опц.), Категория, Заголовок (H4, ссылка), Анонс, Дата.
    5.  Пагинация.
    6.  Футер.

*   **(Страница отдельной статьи (`/blog/article-slug`)):** Хедер, H1 (Заголовок статьи), Мета (дата, автор, категория), Контент (форматированный), Кнопки "Поделиться", Блок "Похожие статьи", Футер.

*   **Адаптивность:** Сетка перестраивается в 1 колонку.

### 4.4. Страница "Контакты" (`/contact`)

*   **Задача:** Предоставить способы связи.
*   **Структура/Компоновка:**
    1.  Хедер.
    2.  H1: "Свяжитесь со мной".
    3.  Контактная информация: Телефон, Email, Мессенджеры (TG, WA - иконки, ссылки), Адрес (если есть, с картой).
    4.  Форма обратной связи: H3 ("Задать вопрос"), Поля (Имя, Email/Телефон, Сообщение), Чекбокс согласия на обработку ПДн (ссылка на Политику), Кнопка "Отправить".
    5.  Футер.

*   **Адаптивность:** 1 колонка на мобильных.

*(Опционально: Страница "Обо мне" (`/about`) с информацией о юристе, опыте, подходе к работе).*

---

## 5. Технические требования

### 5.1. Frontend

*   **Языки:** HTML5, CSS3, JavaScript (ES6+).
*   **Фреймворк:** **React (v18+)**. *(Альтернатива: Next.js для упрощения роутинга, SSR/SSG для блога и интеграции API routes, если не используется отдельный Django backend для всего)*.
*   **Стилизация:** **Tailwind CSS (v3+)**. Использовать возможности Tailwind для темной темы (`dark:` префиксы), CSS переменные для цветов.
*   **Анимации:** **Framer Motion** (для React) или CSS Transitions/Animations.
*   **Запросы к API:** Использовать `fetch` или `axios` для взаимодействия с Django API.
*   **Адаптивность:** Обязательная (Mobile < 768px, Tablet 768px-1024px, Desktop > 1024px). Mobile-first.
*   **Доступность (Accessibility):** Базовые принципы WCAG.
*   **Производительность:** Оптимизация изображений (WebP), lazy loading, минимизация CSS/JS, Code Splitting. Цель: хорошие показатели PageSpeed Insights.

### 5.2. Backend

*   **Язык:** **Python (v3.10+)**.
*   **Фреймворк:** **Django (v4.x+)** с **Django REST Framework (DRF)**.
*   **База данных:** **PostgreSQL** (рекомендуется для надежности) или SQLite (для простоты). Использовать **Django ORM** и систему миграций.
*   **Управление контентом (Блог):** Использовать **встроенную Django Admin** для CRUD операций со статьями, категориями и т.д.
*   **API Эндпоинты (DRF):**
    *   `/api/rkn/check/`: Проверка ИНН (принимает ИНН, возвращает статус, детали, ссылку РКН).
    *   `/api/rkn/download-pdf/`: Генерация и отдача PDF с результатами проверки (принимает ИНН или ID проверки).
    *   `/api/stats/`: Получение статистики сайта (кол-во проверок, кол-во найденных).
    *   `/api/contact/`: Прием данных формы контактов.
    *   `/api/blog/articles/`: Список статей (с пагинацией, фильтрацией по категориям).
    *   `/api/blog/articles/<slug>/`: Получение данных конкретной статьи.
    *   `/api/blog/categories/`: Список категорий блога.
*   **Проверка РКН:**
    *   **Парсинг:** **Selenium WebDriver (v4+)** + **ChromeDriver** (`headless` режим) для `pd.rkn.gov.ru`. *Помнить о хрупкости парсинга и необходимости мониторинга/обновления селекторов.*
    *   **Кэширование результатов:** В БД (модель `RknCheckCache` с полями `inn`, `status`, `data`, `check_timestamp` и т.д.). Логика: проверка свежести кеша (< 24ч) перед запуском Selenium.
    *   **Фоновые задачи:** Рассмотреть **Celery + Redis** или **Django-Q** для запуска Selenium-парсера асинхронно, чтобы не блокировать API-запрос надолго.
*   **Ограничение запросов (Rate Limiting):** Использовать **Redis** и пакет `django-ratelimit` или кастомную реализацию для ограничения частоты запросов к API проверки РКН (например, 5 запросов/мин с IP).
*   **Генерация PDF:** Библиотека **ReportLab** или **WeasyPrint**.
*   **Форма обратной связи:** Валидация на бэкенде, отправка email администратору (юристу), возможно сохранение в БД через Django Admin.
*   **Статистика:** Реализовать подсчет запросов и успешных проверок в БД (агрегация `RknCheckCache` или отдельная модель `SiteStats`).

### 5.3. Прочее

*   **Куки:** Реализация баннера и логики согласия на Frontend (`localStorage`), условная загрузка скриптов (Яндекс.Метрика).
*   **SEO:**
    *   Семантическая верстка, уникальные `title`, `description` для всех страниц (включая блог), `alt` у изображений.
    *   Генерация `robots.txt`.
    *   **Автоматически обновляемый `sitemap.xml`** (использовать Django `sitemap` framework).
    *   **Микроразметка Schema.org:** Для статей (`Article`), контактов (`ContactPage`, `LegalService`), услуг (`Service`).
*   **Хостинг:** VPS (DigitalOcean, Vultr, Timeweb Cloud) или PaaS (Heroku, Render). Настройка **Nginx/Gunicorn** для Django. Обязательно **HTTPS** (Let's Encrypt).
*   **Резервное копирование:** Ежедневное бэкапирование БД и статических/медиа файлов.

---

## 6. Этапы работы (Ориентировочные)

1.  **Дизайн и Прототипирование (1-2 недели):**
    *   Создание/доработка макетов Figma (Главная, Инструменты, Статья, Контакты - Desktop/Mobile) + базовый UI Kit (стили, компоненты).
    *   Утверждение.
2.  **Backend разработка (Django) (2-4 недели):**
    *   Настройка Django проекта, БД, DRF, Admin.
    *   Создание моделей (Статьи, Категории, Кеш РКН, Статистика).
    *   Настройка Django Admin для блога.
    *   Реализация логики проверки РКН (Selenium, кэширование, фоновые задачи).
    *   Реализация Rate Limiting (Redis).
    *   Создание API эндпоинтов (DRF).
    *   Реализация формы контактов, генерации PDF.
3.  **Frontend разработка (React) (2-3 недели):**
    *   Верстка страниц по макетам (React + Tailwind CSS).
    *   Реализация адаптивности, анимаций, переключателя тем, куки-баннера.
    *   Интеграция с Django API.
4.  **Тестирование и Отладка (1-2 недели):**
    *   Функциональное тестирование (формы, РКН, PDF, блог, админка).
    *   Тестирование верстки и адаптивности (разные браузеры/устройства).
    *   Тестирование темной/светлой темы.
    *   Проверка производительности.
    *   Исправление багов.
5.  **Развертывание (Deployment) (2-3 дня):**
    *   Настройка сервера (VPS/PaaS), Nginx, Gunicorn, PostgreSQL, Redis, Celery (если используется).
    *   Настройка HTTPS.
    *   Загрузка кода, настройка окружения.
    *   Финальное тестирование.
6.  **Сдача проекта и документация.**

---

## 7. Что особенно важно

*   **Достижение премиального визуального стиля:** Фокус на типографике, пространстве, UI-элементах, двух темах.
*   **Точное следование дизайн-концепции и макетам.**
*   **Безупречная работа инструмента проверки РКН:** Стабильность парсера (с пониманием рисков), корректное кэширование, обработка лимитов, асинхронность.
*   **Удобное управление блогом через Django Admin.**
*   **Высокое качество адаптивной верстки и кроссбраузерность.**
*   **Корректная работа переключателя тем.**
*   **Чистый и поддерживаемый код** (Python/Django и React/JS).
*   **Реализация функционала куки-баннера.**
*   **Скорость загрузки страниц и SEO-оптимизация.**

---

## 8. Использование существующего кода PD_Checker_cli

В рамках разработки сайта "Цифровой юрист" рекомендуется адаптировать и повторно использовать существующий код проекта PD_Checker_cli, который уже реализует основную логику проверки компаний в реестре Роскомнадзора:

### 8.1. Интеграция парсера РКН

* **Исходная логика:** Существующий CLI-инструмент использует Selenium для автоматизации проверок на сайте РКН и парсинга результатов. Этот код может быть трансформирован в сервисный слой Django.
* **Рекомендуемая структура интеграции:**
  * Преобразовать существующий парсер в Django-совместимый Python-модуль `rkn_parser.py` в соответствующем приложении Django.
  * Создать Django-модели для хранения результатов проверок и кэширования данных.
  * Реализовать сервисный слой для взаимодействия между API и модулем парсера.

### 8.2. Адаптация драйвера Selenium

* **Текущая реализация:** В CLI-версии используется Selenium WebDriver с настройками для работы с сайтом pd.rkn.gov.ru.
* **Рекомендации для веб-приложения:**
  * Использовать `headless` режим для Chrome/Firefox в продакшн-окружении.
  * Реализовать пул драйверов или систему повторных попыток для повышения надежности.
  * Реализовать асинхронное выполнение проверок (Celery) для предотвращения таймаутов и обеспечения отзывчивости API.

### 8.3. Кэширование результатов

* **Существующее решение:** CLI-версия сохраняет результаты в локальных файлах.
* **Для веб-версии:**
  * Перенести логику кэширования в модели Django для хранения результатов проверок.
  * Использовать Django ORM для фильтрации и поиска по истории проверок.
  * Реализовать механизм проверки актуальности кэша (24 часа) перед запуском парсера.
  * Использовать Redis для хранения временных результатов и статистики.

### 8.4. Обработка специфических ошибок и исключений

* **Существующий опыт:** CLI-версия содержит обработку ошибок Selenium, таймаутов, капчи и особенностей структуры сайта РКН.
* **Для веб-версии:**
  * Перенести и адаптировать логику обработки ошибок для API-контекста.
  * Добавить специфические HTTP-коды и форматы ответов для различных сценариев ошибок.
  * Реализовать журналирование ошибок и мониторинг работоспособности парсера.

### 8.5. Генерация отчётов

* **Текущая функциональность:** CLI-версия может выводить результаты в консоль или HTML.
* **Для веб-версии:**
  * Перенести и адаптировать логику генерации HTML-отчетов в Django Templates.
  * Использовать ReportLab или WeasyPrint для генерации PDF-отчетов.
  * Добавить брендирование и профессиональное форматирование отчётов.

### 8.6. Рекомендации по рефакторингу

* **Модульность:** Разделить существующий код на логические компоненты, соответствующие Django-приложениям.
* **Тестирование:** Написать юнит-тесты и интеграционные тесты для адаптированного кода.
* **Документация:** Создать подробную документацию по API и интеграции с фронтендом.
* **Мониторинг:** Реализовать систему уведомлений об ошибках и изменениях структуры сайта РКН.

---

## 9. Рекомендуемая структура Django-проекта

### 9.1. Приложения (apps)

* **core** - основные настройки проекта и общие утилиты
* **rkn_checker** - логика работы с реестром РКН, адаптированная из CLI-версии
* **blog** - функциональность для блога и управления контентом
* **contact** - обработка форм обратной связи
* **users** - авторизация и управление пользователями (админ)
* **stats** - сбор и отображение статистики

### 9.2. Модели данных

* **RknCheck** (`rkn_checker/models.py`):
  ```python
  class RknCheck(models.Model):
      inn = models.CharField(max_length=12, db_index=True)
      status = models.BooleanField(default=False)  # True если найден
      company_name = models.CharField(max_length=255, null=True, blank=True)
      registration_number = models.CharField(max_length=100, null=True, blank=True)
      registration_date = models.DateField(null=True, blank=True)
      responsible_person = models.CharField(max_length=255, null=True, blank=True)
      raw_data = models.JSONField(null=True, blank=True)  # Сохранение всех данных
      link = models.URLField(null=True, blank=True)  # Ссылка на карточку РКН
      check_timestamp = models.DateTimeField(auto_now_add=True)
      ip_address = models.GenericIPAddressField(null=True, blank=True)
      is_cached = models.BooleanField(default=False)  # Флаг использования кэша
      
      class Meta:
          indexes = [
              models.Index(fields=['inn', 'check_timestamp']),
          ]
  ```

* **SiteStats** (`stats/models.py`):
  ```python
  class SiteStats(models.Model):
      date = models.DateField(unique=True, default=timezone.now)
      total_checks = models.PositiveIntegerField(default=0)
      found_in_registry = models.PositiveIntegerField(default=0)
      not_found_in_registry = models.PositiveIntegerField(default=0)
      errors = models.PositiveIntegerField(default=0)
      
      class Meta:
          indexes = [
              models.Index(fields=['date']),
          ]
  ```

### 9.3. Celery задачи для асинхронных проверок

Создать файл `rkn_checker/tasks.py`:
```python
@shared_task(bind=True, max_retries=3)
def check_inn_task(self, inn, check_id=None):
    """
    Асинхронная задача для проверки ИНН в реестре РКН
    """
    try:
        # Инициализация и выполнение проверки через адаптированный парсер
        checker = RknChecker()
        result = checker.check_inn(inn)
        
        # Сохранение результатов в БД
        if check_id:
            check = RknCheck.objects.get(id=check_id)
            check.status = result['found']
            check.company_name = result.get('name')
            # ... остальные поля
            check.is_cached = False
            check.save()
        
        # Обновление статистики
        update_stats(found=result['found'])
        
        return result
    except Exception as e:
        logger.error(f"Error checking INN {inn}: {str(e)}")
        self.retry(exc=e, countdown=60*5)  # Повторить через 5 минут
```

Эти дополнения в ТЗ помогут команде разработчиков эффективно использовать существующий код проекта PD_Checker_cli и адаптировать его для веб-приложения на Django.

